<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>dispatch_group管理任务依赖 | 托尼的夏天</title>
  <meta name="author" content="tony2009">
  
  <meta name="description" content="场景123456789101112NSArray *urlStrings = @[ @&amp;quot;http://octree.me&amp;quot;, @&amp;quot;http://google.com&amp;quot;, @&amp;quot;http://github.com&amp;quot; ];for(NSString">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="dispatch_group管理任务依赖"/>
  <meta property="og:site_name" content="托尼的夏天"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="托尼的夏天" type="application/atom+xml">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
<link rel="stylesheet" href="/css/style.css">
  <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-368771XX-X']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>

<body>
  <header id="header" class='normal_mode'>
    <nav id="main-nav">
  <ul class='container'>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
  </header>
  <div id="content" class="container">
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
      <time datetime="2016-07-03T07:13:11.000Z"><a href="/2016/07/03/dispatch-group/">Sun, Jul 3 2016, 3:13:11 pm</a></time>

  
    <h1 class="title">dispatch_group管理任务依赖</h1>
  



<div class="clear"></div>
      
    </header>
    <div class="entry">
      
        <h4 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">NSArray *urlStrings = @[ @&quot;http://octree.me&quot;, @&quot;http://google.com&quot;, @&quot;http://github.com&quot; ];</span><br><span class="line"></span><br><span class="line">for(NSString urlString in urlStrings) &#123;  </span><br><span class="line">    AFHTTPRequestOperationManager *manager = [AFHTTPRequestOperationManager manager];</span><br><span class="line">    [manager GET:urlString parameters:nil success:^(AFHTTPRequestOperation *operation, id responseObject) &#123;  </span><br><span class="line">        //do sth </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">     &#125; failure:^(AFHTTPRequestOperation *operation, NSError *error) &#123;</span><br><span class="line">        NSLog(@&quot;Error: %@&quot;, error);</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时发起网络请求，但是我们需要在三个网络请求都成功获取数据后才执行do sth，显然上面的写法不符合要求，</p>
<h4 id="dispatch-group"><a href="#dispatch-group" class="headerlink" title="dispatch_group"></a>dispatch_group</h4><blockquote>
<p>Grouping blocks allows for aggregate synchronization. Your application can submit multiple blocks and track when they all complete, even though they might run on different queues. This behavior can be helpful when progress can’t be made until all of the specified tasks are complete.</p>
</blockquote>
<p>dispatch_group提供了多个block同步的机制，可以再多个不同bloc都执行完后再去执行指定的任务</p>
<p>相关函数: </p>
<p>dispatch_group_enter:</p>
<blockquote>
<p> Explicitly indicates that a block has entered the group.Calling this function increments the current count of outstanding tasks in the group</p>
</blockquote>
<p>dispatch_group_leave : </p>
<blockquote>
<p>Explicitly indicates that a block in the group has completed.Calling this function decrements the current count of outstanding tasks in the group</p>
</blockquote>
<p>dispatch_group_notify</p>
<blockquote>
<p> Schedules a block object to be submitted to a queue when a group of previously submitted block objects have completed.</p>
</blockquote>
<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><pre><code>NSArray *urlStrings = @[ @&quot;http://octree.me&quot;, @&quot;http://google.com&quot;, @&quot;http://github.com&quot; ];

dispatch_group_t requestGroup = dispatch_group_create(); 
for(NSString urlString in urlStrings) {
  dispatch_group_enter(requestGroup);   //当前的任务加入group
  AFHTTPRequestOperationManager *manager = [AFHTTPRequestOperationManager manager];
  [manager GET:urlString parameters:nil success:^(AFHTTPRequestOperation *operation, id responseObject) {
      NSLog(@&quot;Success&quot;);
      dispatch_group_leave(requestGroup);
   } failure:^(AFHTTPRequestOperation *operation, NSError *error) {
      NSLog(@&quot;Error: %@&quot;, error);
      dispatch_group_leave(requestGroup); // 当前的任务已经执行完
  }];
}

dispatch_group_notify(requestGroup, dispatch_get_main_queue(), ^{ // 上面的
    //doSomething
});
</code></pre><p>参考: </p>
<p><a href="http://outofmemory.cn/objective-c/ios-async-task-monitor" target="_blank" rel="external">iOS 多个异步任务的监控</a></p>

      
    </div>
    <footer>
      
          
<!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
  <span class="jiathis_txt">分享到：</span>
  <a class="jiathis_button_weixin">微信</a>
  <a class="jiathis_button_tsina">新浪微博</a>
  <a class="jiathis_button_renren">人人网</a>
  <a class="jiathis_button_qzone">QQ空间</a>
  <a class="jiathis_button_douban">豆瓣</a>
  <a class="jiathis_button_pocket">Pocket</a>
  <a href="http://www.jiathis.com/share?uid=901656" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
  <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code_mini/jia.js?uid=901656" charset="utf-8"></script>
<!-- JiaThis Button END -->

          <div class="clearfix"></div>
          <nav id="pagination">
  
    <a href="/2016/07/28/reactive-cocoa学习笔记/" class="alignleft prev"><i class="fa fa-long-arrow-left"></i>Next</a>
  
  
    <a href="/2016/05/01/swift-protocol/" class="alignright next">Prev<i class="fa fa-long-arrow-right"></i></a>
  
  <div class="clearfix"></div>
</nav>
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">Kommentare</h1>

  
      <!-- Duoshuo Comment BEGIN -->
<div class="ds-thread" data-thread-key="/2016/07/03/dispatch-group/"></div>
<!-- Duoshuo Comment END -->
  
</section>



    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div>
  
  &copy; 2016 tony2009
  
</div>
Powered by <a href="http://zespia.tw/hexo/" title="Hexo" target="_blank" rel="external">Hexo</a> and <a href="http://pages.github.com/" title="GitHub Pages" target="_blank" rel="external">GitHub Pages</a>

<div class="clearfix"></div></footer>
  
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>




    <script type="text/javascript">
        (function(){

            $(window).scroll(function(){

                var scrollTop = $(window).scrollTop();
                if ( scrollTop >200 ){
                    $("#main-nav").removeClass('normal_mode').addClass('top_mode');
                } else{
                    $("#main-nav").removeClass('top_mode').addClass('normal_mode');
                }

            });

        })();
    </script>



  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript">
  (function($){
    $('.fancybox').fancybox({
      'titlePosition': 'inside'
    });
  })(jQuery);
  </script>



    
    <script type="text/javascript">
      var duoshuoQuery = {short_name:"your_id"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = 'http://static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0] 
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>



<script type="text/javascript">
  
  $(function(){

    $('.title').hover(
      function() {      
        $(this).stop().animate(
          {'marginLeft': '10px'}, 200
        );   
      }, 
      function() {       
        $(this).stop().animate({'marginLeft': '0px'}, 200);      
      
    });   

  });

</script>


</body>
</html>