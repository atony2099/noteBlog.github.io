<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="æ‰˜å°¼çš„å¼€å‘ç¬”è®°">
<meta property="og:url" content="atony2099.github.io/page/7/index.html">
<meta property="og:site_name" content="æ‰˜å°¼çš„å¼€å‘ç¬”è®°">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="æ‰˜å°¼çš„å¼€å‘ç¬”è®°">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="atony2099.github.io/page/7/"/>





  <title> æ‰˜å°¼çš„å¼€å‘ç¬”è®° </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">æ‰˜å°¼çš„å¼€å‘ç¬”è®°</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="atony2099.github.io/2016/02/11/æ€§èƒ½ä¼˜åŒ–/UIViewçš„ç»˜åˆ¶/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="tony2009">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="æ‰˜å°¼çš„å¼€å‘ç¬”è®°">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="æ‰˜å°¼çš„å¼€å‘ç¬”è®°" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/11/æ€§èƒ½ä¼˜åŒ–/UIViewçš„ç»˜åˆ¶/" itemprop="url">
                  UIViewçš„ç»˜åˆ¶
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-02-11T10:28:35+08:00">
                2016-02
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="CPUæµç¨‹"><a href="#CPUæµç¨‹" class="headerlink" title="CPUæµç¨‹"></a>CPUæµç¨‹</h4><p><img src="http://ohbzayk4i.bkt.clouddn.com/17-1-21/11221206-file_1484987191790_9c88.png" alt=""></p>
<ol>
<li><p>æ¯ä¸€ä¸ªViewéƒ½æ˜¯ä¸€ä¸ªLayerï¼Œæ¯ä¸€ä¸ªlayeréƒ½æœ‰ä¸€ä¸ªcontentï¼Œè¿™ä¸ªcontentæŒ‡å‘ä¸€ä¸ªç¼“å­˜ï¼Œå«åšbackingstoreã€‚</p>
<p>Layerç®¡ç†ä½å›¾çŠ¶æ€ä¿¡æ¯</p>
<blockquote>
<p>A layer merely manages the state information surrounding a bitmap. </p>
</blockquote>
</li>
<li><p>å½“Viewç»˜åˆ¶çš„æ—¶å€™ï¼ŒCPUæ‰§è¡ŒdrawRectï¼Œå†™å…¥layerçš„backingstore</p>
<p>â€‹</p>
<h4 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">UILabel* label = [[UILabel alloc]initWithFrame:CGRectMake(10, 50, 300, 14)];</span><br><span class="line">label.backgroundColor = [UIColor whiteColor];</span><br><span class="line">label.font = [UIFont systemFontOfSize:14.0f];</span><br><span class="line">label.text = @&quot;test&quot;;</span><br><span class="line">[self.view addSubview:label];</span><br></pre></td></tr></table></figure>
<ol>
<li><p>dirty views</p>
<blockquote>
<p>å½“ä¸€ä¸ªviewæ”¹å˜å¸ƒå±€æˆ–è€…å±æ€§,æˆ–è€…ä¸»åŠ¨è°ƒç”¨setneedlaytout/setneeddisplayï¼Œè¿™ä¸ªviewå°±ä¼šè¢«æ ‡è®°ä¸ºdirty views,</p>
</blockquote>
<p><img src="http://my.csdn.net/uploads/201207/19/1342691059_7152.jpg" alt=""></p>
<p>â€‹</p>
</li>
</ol>
<p><img src="http://ohbzayk4i.bkt.clouddn.com/17-1-21/54271723-file_1484987856789_1150d.png" alt=""></p>
<ol>
<li><p>åœ¨runloopå‘¨æœŸå¼€å§‹çš„æ—¶å€™ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// coreanimaiton æ³¨å†Œäº†ä¸€ä¸ª Observer ç›‘å¬ BeforeWaiting(å³å°†è¿›å…¥ä¼‘çœ ) å’Œ Exit (å³å°†é€€å‡ºLoop) äº‹ä»¶</span><br><span class="line">//å½“mainThreadå³å°†ä¼‘çœ çš„æ—¶å€™è°ƒç”¨</span><br><span class="line">[CATransaction commit] </span><br><span class="line">// å°†dirty viewæäº¤åˆ°å…¨å±€çš„ä¸€ä¸ªå®¹å™¨é‡Œé¢</span><br></pre></td></tr></table></figure>
</li>
<li><p>drawrectè¢«è°ƒç”¨ï¼Œé€šè¿‡Core Graphicçš„çš„apiç»˜åˆ¶bitmapï¼Œå†™å…¥layerçš„backingstore</p>
</li>
<li><p>æ¸…ç©ºdirty flagæ ‡è®°</p>
</li>
<li><p>å½“labelçš„å†…å®¹æ”¹å˜çš„æ—¶å€™ï¼Œé‡æ–°è¢«æ ‡å¿—ä½dirtyã€‚</p>
</li>
</ol>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">_ZN2CA11Transaction17observer_callbackEP19__CFRunLoopObservermPv()</span><br><span class="line">   QuartzCore:CA::Transaction::observer_callback:</span><br><span class="line">       CA::Transaction::commit();</span><br><span class="line">           CA::Context::commit_transaction();</span><br><span class="line">               CA::Layer::layout_and_display_if_needed();</span><br><span class="line">                   CA::Layer::layout_if_needed();</span><br><span class="line">                         [CALayer layoutSublayers];</span><br><span class="line">                         [UIView layoutSubviews];</span><br><span class="line">                   CA::Layer::display_if_needed();</span><br><span class="line">                         [CALayer display];</span><br><span class="line">                         [UIView drawRect];</span><br></pre></td></tr></table></figure>
<blockquote>
<p> æˆ‘ä»¬çš„è¦æ¸²æŸ“çš„layerå·²ç»æœ‰äº†bitmap contentçš„æ—¶å€™ï¼Œè¿™ä¸ªcontentä¸€èˆ¬æ¥è¯´æ˜¯ä¸€ä¸ªCGImageRefï¼ŒCoreAnimationä¼šåˆ›å»ºä¸€ä¸ªOpenGLçš„Textureå¹¶å°†CGImageRefï¼ˆbitmapï¼‰å’Œè¿™ä¸ªTextureç»‘å®šï¼Œé€šè¿‡TextureIDæ¥æ ‡è¯†ã€‚</p>
<p> è¿™ä¸ªå¯¹åº”å…³ç³»å»ºç«‹èµ·æ¥ä¹‹åï¼Œå‰©ä¸‹çš„ä»»åŠ¡å°±æ˜¯GPUå¦‚ä½•å°†Textureæ¸²æŸ“åˆ°å±å¹•ä¸Šäº†ã€‚</p>
<p> <strong>ç®€è€Œè¨€ä¹‹ï¼ŒCoreAnimationä¼šå°†bitmapå…ˆè½¬æ¢ä¸ºgpuå¯å¤„ç†çš„texture</strong></p>
</blockquote>
<h4 id="GPU"><a href="#GPU" class="headerlink" title="GPU"></a>GPU</h4><p><img src="http://vizlabxt.github.io/images/2013/11/QQ20131123-4.png" alt=""></p>
<blockquote>
<ol>
<li>CPUå°†å‡†å¤‡å¥½çš„bitmapæ”¾åˆ°RAMé‡Œï¼ŒGPUå»æ¬è¿™å¿«å†…å­˜åˆ°VRAMä¸­å¤„ç†ã€‚</li>
<li>åˆæˆå’Œæ¸²æŸ“texture</li>
</ol>
</blockquote>
<h5 id="Compositingï¼š"><a href="#Compositingï¼š" class="headerlink" title="Compositingï¼š"></a>Compositingï¼š</h5><p>Compositingæ˜¯æŒ‡å°†å¤šä¸ªçº¹ç†æ‹¼åˆ°ä¸€èµ·çš„è¿‡ç¨‹ï¼Œ</p>
<p>ä¸¤ä¸ªviewå åŠ åœ¨ä¸€èµ·ï¼Œè®¡ç®—å…¬å¼å¦‚ä¸‹:</p>
<blockquote>
<p>R = S+D*(1-Sa)</p>
</blockquote>
<p>R = S+D*(1-Sa)`</p>
<p><code>R</code>: ä¸ºæœ€ç»ˆçš„åƒç´ å€¼</p>
<p><code>S</code>: ä»£è¡¨ ä¸Šé¢çš„Textureï¼ˆTop Textureï¼‰</p>
<p><code>D</code>: ä»£è¡¨ä¸‹é¢çš„Texture(lower Texture)</p>
<p>å…¶ä¸­S,Déƒ½å·²ç»pre-multipliedå„è‡ªçš„alphaå€¼ã€‚</p>
<p><code>Sa</code>ä»£è¡¨Textureçš„alphaå€¼ã€‚</p>
<blockquote>
<p>viewå±‚çº§è¶Šå¤æ‚ï¼Œalpha = 1è¶Šå¤šï¼Œè®¡ç®—è¶Šå¤æ‚ã€‚</p>
</blockquote>
<h4 id="UIView-å’ŒCAlayeråŒºåˆ«"><a href="#UIView-å’ŒCAlayeråŒºåˆ«" class="headerlink" title="UIView å’ŒCAlayeråŒºåˆ«"></a>UIView å’ŒCAlayeråŒºåˆ«</h4><ul>
<li>å°è£…: UIViewæ˜¯åœ¨Calayer åŸºç¡€ä¸Šè¿›ä¸€æ­¥å°è£…ï¼Œæ¯ä¸ªUIViewéƒ½æœ‰ä¸€ä¸ªRootLayerï¼Œ</li>
</ul>
<ol>
<li>UIViewä¸€äº›åŸºç¡€å‡ ä½•å±æ€§æ¥è‡ªäºlayer</li>
</ol>
<ol>
<li><p>UIViewç»§æ‰¿äº†Responderï¼Œå“åº”äº‹ä»¶</p>
<p>â€‹</p>
</li>
</ol>
<ul>
<li>ç»˜åˆ¶ å’Œ æ˜¾ç¤º: UIViewåº•å±‚è°ƒç”¨coreGraphicsç»˜åˆ¶è§†å›¾ä¿¡æ¯ï¼Œè¿™äº›ç»˜å›¾ä¿¡æ¯ä¼šè¢«è½¬æ¢ä¸ºbitMapæ•°æ®ç¼“å­˜åˆ°Calyerçš„backingStoreï¼Œ</li>
</ul>
<ul>
<li>ç¼“å­˜åœ¨è‡ªå·±çš„contentsä¸­ï¼Œè¿›ä¸€æ­¥é€šè¿‡CoreAnimaiton å°†è¿™äº›ä½å›¾ä¿¡æ¯æäº¤åˆ°GPUè¿›è¡Œæ¸²æŸ“å’Œåˆæˆã€‚</li>
</ul>
<p><a href="http://joeshang.github.io/2015/01/10/understand-contentsscale/" target="_blank" rel="external">ç†è§£contentsScale</a></p>
<p><a href="http://vizlabxt.github.io/blog/2012/10/22/UIView-Rendering/" target="_blank" rel="external">ç†è§£UIViewçš„ç»˜åˆ¶</a></p>
<p><a href="http://www.jianshu.com/p/079e5cf0f014" target="_blank" rel="external">è¯¦è§£CALayer å’Œ UIViewçš„åŒºåˆ«å’Œè”ç³»</a></p>
<p><a href="https://learnopengl-cn.readthedocs.io/zh/latest/01%20Getting%20started/06%20Textures/" target="_blank" rel="external">OPENGL</a></p>
<p><a href="http://apprize.info/apple/ios/6.html" target="_blank" rel="external">iOS Programming: The Big Nerd Ranch Guide (2014)</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="atony2099.github.io/2016/02/08/atomic/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="tony2009">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="æ‰˜å°¼çš„å¼€å‘ç¬”è®°">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="æ‰˜å°¼çš„å¼€å‘ç¬”è®°" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/08/atomic/" itemprop="url">
                  nonatomic VS atomic
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-02-08T01:26:58+08:00">
                2016-02
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>stackoverflowä¸Šå…³äºè¿™ä¸ªé—®é¢˜çš„è®¨è®º:<a href="http://stackoverflow.com/questions/588866/whats-the-difference-between-the-atomic-and-nonatomic-attributes" target="_blank" rel="external">Whatâ€™s the difference between the atomic and nonatomic attributes?</a></p>
<p>ä¸»è¦åœ¨äºä»–ä»¬ç”Ÿæˆçš„getter å’Œsetteræ–¹æ³•æœ‰æ‰€ä¸åŒã€‚</p>
<p>å¯¹äºatomicå…³é”®å­—ï¼Œç›¸å…³ä¼ªä»£ç å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (UITextField *) userName &#123;</span><br><span class="line">    </span><br><span class="line">    @synchronized(self) &#123;</span><br><span class="line">       return _userName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void) setUserName:(UITextField *)userName &#123;</span><br><span class="line">    @synchronized(self) &#123;</span><br><span class="line">      _userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> ä¹Ÿå°±æ˜¯é€šè¿‡åŠ é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œèƒ½é¿å…çº¿ç¨‹åˆ†é…ç«äº‰ï¼Œä¿è¯æ•°æ®æ“ä½œçš„å®Œæ•´æ€§</p>
<p>æ›´å…·ä½“ä¾‹å­å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property (atomic)CGRect domain;</span><br></pre></td></tr></table></figure>
<p><img src="https://www.bignerdranch.com/img/blog/2013/10/puppyrect-1.png" alt=""></p>
<p>å‡å¦‚ä½ éœ€è¦åœ¨ä¸¤æ¡çº¿ç¨‹ä¸Šä¿®æ”¹dominï¼Œå¦‚ä¸‹</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; &lt;b&gt;thread 1:&lt;/b&gt; puppy.domain = CGRectMake (1.0, 2.0, 3.0, 4.0);</span><br><span class="line">&gt; &lt;b&gt;thread 2:&lt;/b&gt; puppy.domain = CGRectMake (10.0, 20.0, 30.0, 40.0);</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>ä½ åªä¼šå¾—åˆ°ä¸¤ç§ç»“æœ:</p>
<p><img src="https://www.bignerdranch.com/img/blog/2013/10/puppyrect-3.png" alt=""></p>
<p>æˆ–è€…ï¼š</p>
<p><img src="https://www.bignerdranch.com/img/blog/2013/10/puppyrect-4.png" alt=""></p>
<p>è€Œä¸ä¼šå‡ºç°:</p>
<p><img src="https://www.bignerdranch.com/img/blog/2013/10/puppyrect-2.png" alt=""></p>
<p>è¿™ç§æ··åˆçš„çŠ¶æ€ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¯´atomicæ˜¯ä¸€ç§çº¿ç¨‹å®‰å…¨çš„æœºåˆ¶ï¼Œä½†è¦æ³¨æ„è¿™ç§çº¿ç¨‹å®‰å…¨æ˜¯å±€éƒ¨çš„ï¼Œä¹‹æ‰€ä»¥è¿™æ ·è¯´ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥çœ‹ä¸€ä¸ªä¾‹å­æ›´ç›´è§‚ï¼š</p>
<p>å‡å¦‚puppyæœ‰ä¸‰ä¸ªæˆå‘˜å˜é‡ï¼Œé‚£æˆ‘ä»¬åœ¨Açº¿ç¨‹è®¾ç½®å®ƒçš„å€¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">puppy.name = @&quot;Hoover&quot;;</span><br><span class="line">puppy.domain = CGRectMake (1.0, 2.0, 3.0, 4.0);</span><br><span class="line">puppy.housebroken = NO;</span><br></pre></td></tr></table></figure>
<p>åœ¨bçº¿ç¨‹è®¾ç½®å®ƒçš„å€¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">puppy.name = @&quot;Rumpelstiltskin&quot;;</span><br><span class="line">puppy.domain = CGRectMake (1.0, 2.0, 3.0, 4.0);</span><br><span class="line">puppy.housebroken = YES;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æœ‰å¯èƒ½å¾—åˆ°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">puppy.name = @&quot;Hoover&quot;;</span><br><span class="line">puppy.domain = CGRectMake (10.0, 20.0, 30.0, 40.0);</span><br><span class="line">puppy.housebroken = NO;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ä¸€ç»„ç»“æœï¼Œè¿™ç»„æ•°æ®æ˜¯é”™è¯¯çš„ã€‚æ‰€ä»¥å•çº¯é atomicå¹¶ä¸èƒ½ä¿è¯çœŸæ­£çš„çº¿ç¨‹å®‰å…¨ã€‚</p>
<p>å‚è€ƒ:<a href="https://www.bignerdranch.com/blog/property-values/" target="_blank" rel="external">Property Values</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="atony2099.github.io/2016/02/08/å­—ç¬¦ä¸²ï¼Œæ—¥æœŸçš„å¤„ç†/NSString/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="tony2009">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="æ‰˜å°¼çš„å¼€å‘ç¬”è®°">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="æ‰˜å°¼çš„å¼€å‘ç¬”è®°" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/08/å­—ç¬¦ä¸²ï¼Œæ—¥æœŸçš„å¤„ç†/NSString/" itemprop="url">
                  nonatomic VS atomic
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-02-08T01:26:58+08:00">
                2016-02
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>NSString å¤§æ³•å¥½</p>
</blockquote>
<p>1.<a href="http://stackoverflow.com/questions/2753956/how-do-i-check-if-a-string-contains-another-string-in-objective-c" target="_blank" rel="external">How do I check if a string contains another string in Objective-C</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NSString *string = @&quot;hello bla blah&quot;;</span><br><span class="line">if ([string containsString:@&quot;bla&quot;]) &#123;</span><br><span class="line">  NSLog(@&quot;string contains bla!&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  NSLog(@&quot;string does not contain bla&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="atony2099.github.io/2016/02/08/é¢è¯•å‡†å¤‡/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="tony2009">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="æ‰˜å°¼çš„å¼€å‘ç¬”è®°">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="æ‰˜å°¼çš„å¼€å‘ç¬”è®°" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/08/é¢è¯•å‡†å¤‡/" itemprop="url">
                  nonatomic VS atomic
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-02-08T01:26:58+08:00">
                2016-02
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>é¢è¯•å‡†å¤‡</p>
<ul>
<li>å›¾è§£http  ä¸‰ä¸ªğŸ… &lt;= 4ä¸ªğŸ…</li>
<li>swiftå¤ä¹  </li>
<li>å›¾æ–‡æ··æ’</li>
<li>MVVM + RAC</li>
<li>â€‹</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="atony2099.github.io/2016/02/08/ç½‘ç»œè¯·æ±‚/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="tony2009">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="æ‰˜å°¼çš„å¼€å‘ç¬”è®°">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="æ‰˜å°¼çš„å¼€å‘ç¬”è®°" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/08/ç½‘ç»œè¯·æ±‚/" itemprop="url">
                  nonatomic VS atomic
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-02-08T01:26:58+08:00">
                2016-02
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="BASE"><a href="#BASE" class="headerlink" title="BASE"></a>BASE</h4><p>Apps that communicate with a server via HTTP usually have two particular requirements:</p>
<blockquote>
<p>donâ€™t make the user wait for data whenever possible, </p>
<p> be useful when there is no internet connection</p>
</blockquote>
<p>iOS  has the APIs we need to implement response caching and offline mode.</p>
<p>Very little code is required, even less if your server plays nice with cache headers and youâ€™re targeting iOS 7 and above.</p>
<p>The shared <code>NSURLCache</code> gives us much out of the box</p>
<h4 id="offlineMode"><a href="#offlineMode" class="headerlink" title="offlineMode"></a>offlineMode</h4><p>In most cases, showing old data is better that showing no data (exceptions being weather and stock, for example). </p>
<p>If we want our offline mode to always return the cached data, then our requests must have a different cache policy, one that uses cache data regardless of its expiration date. Both <code>NSURLRequestReturnCacheDataDontLoad</code> and <code>NSURLRequestReturnCacheDataElseLoad</code> fit this criteria. In particular, <code>NSURLRequestReturnCacheDataElseLoad</code>has the advantage of trying the network if no cached response is found</p>
<ol>
<li>what is cache-Control </li>
</ol>
<h4 id="Http-Request"><a href="#Http-Request" class="headerlink" title="Http  Request"></a>Http  Request</h4><ol>
<li><p>http  request</p>
<ul>
<li>è¯·æ±‚è¡Œ</li>
<li>è¯·æ±‚å¤´: </li>
<li>è¯·æ±‚ä½“</li>
</ul>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; POST /index.php HTTP/1.1</span><br><span class="line">&gt; Host: localhost</span><br><span class="line">&gt; User-Agent: Mozilla/5.0 (Windows NT 5.1; rv:10.0.2) Gecko/20100101 Firefox/10.0.2</span><br><span class="line">&gt; Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">&gt; Accept-Language: zh-cn,zh;q=0.5</span><br><span class="line">&gt; Accept-Encoding: gzip, deflate</span><br><span class="line">&gt; Connection: keep-alive</span><br><span class="line">&gt; Referer: http://localhost/</span><br><span class="line">&gt; Content-Lengthï¼š25</span><br><span class="line">&gt; Content-Typeï¼šapplication/x-www-form-urlencoded</span><br><span class="line">&gt;</span><br><span class="line">&gt; username=aa&amp;password=1234</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>http response</p>
<ul>
<li>å“åº”è¡Œ</li>
<li>å“åº”å¤´</li>
<li>å“åº”ä½“</li>
</ul>
</li>
</ol>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&gt; HTTP/1.1 200 OK</span><br><span class="line">&gt; Date: Sun, 17 Mar 2013 08:12:54 GMT</span><br><span class="line">&gt; Server: Apache/2.2.8 (Win32) PHP/5.2.5</span><br><span class="line">&gt; X-Powered-By: PHP/5.2.5</span><br><span class="line">&gt; Set-Cookie: PHPSESSID=c0huq7pdkmm5gg6osoe3mgjmm3; path=/</span><br><span class="line">&gt; Expires: Thu, 19 Nov 1981 08:52:00 GMT</span><br><span class="line">&gt; Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0</span><br><span class="line">&gt; Pragma: no-cache</span><br><span class="line">&gt; Content-Length: 4393</span><br><span class="line">&gt; Keep-Alive: timeout=5, max=100</span><br><span class="line">&gt; Connection: Keep-Alive</span><br><span class="line">&gt; Content-Type: text/html; charset=utf-8</span><br><span class="line">&gt;</span><br><span class="line">&gt;</span><br><span class="line">&gt; &lt;html&gt;</span><br><span class="line">&gt; &lt;head&gt;</span><br><span class="line">&gt; &lt;title&gt;HTTPå“åº”ç¤ºä¾‹&lt;title&gt;</span><br><span class="line">&gt; &lt;/head&gt;</span><br><span class="line">&gt; &lt;body&gt;</span><br><span class="line">&gt; Hello HTTP!</span><br><span class="line">&gt; &lt;/body&gt;</span><br><span class="line">&gt; &lt;/html&gt;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>http çš„ç¼“å­˜ç­–ç•¥  Cache-Control</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Cache-Control: <span class="keyword">private</span>/<span class="keyword">public</span> Public å“åº”ä¼šè¢«ç¼“å­˜ï¼Œå¹¶ä¸”åœ¨å¤šç”¨æˆ·é—´å…±äº«ã€‚ Private å“åº”åªèƒ½å¤Ÿä½œä¸ºç§æœ‰çš„ç¼“å­˜ï¼Œä¸èƒ½å†ç”¨æˆ·é—´å…±äº«ã€‚</span><br><span class="line">Cache-Control: no-cacheï¼šä¸è¿›è¡Œç¼“å­˜ </span><br><span class="line">Cache-Control: max-age=xï¼šç¼“å­˜æ—¶é—´ ä»¥ç§’ä¸ºå•ä½ </span><br><span class="line">Cache-Control: must-revalidateï¼šå¦‚æœé¡µé¢æ˜¯è¿‡æœŸçš„ åˆ™å»æœåŠ¡å™¨è¿›è¡Œè·å–ã€‚</span><br></pre></td></tr></table></figure>
<p>http1.0 vs http 1.0  response header</p>
<p>Pragma : no-cache è¡¨ç¤ºé˜²æ­¢å®¢æˆ·ç«¯ç¼“å­˜ï¼Œéœ€è¦å¼ºåˆ¶ä»æœåŠ¡å™¨è·å–æœ€æ–°çš„æ•°æ®ï¼›<br>Expires: HTTP1.0 å“åº”å¤´ï¼Œæœ¬åœ°å‰¯æœ¬ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœå®¢æœç«¯å‘ç°ç¼“å­˜æ–‡ä»¶æ²¡æœ‰è¿‡æœŸåˆ™ä¸å‘é€è¯·æ±‚ï¼ŒHTTPçš„æ—¥æœŸå¿…é¡»æ˜¯æ ¼æ—å¨æ²»æ—¶é—´ï¼ˆGMTï¼‰,å¦‚â€Expires:Wed,14 Mar 2015 14:30:32 GMTâ€ </p>
<p>Cache-Control </p>
<h4 id="how-cache-control-work"><a href="#how-cache-control-work" class="headerlink" title="how cache-control work"></a>how cache-control work</h4><p>An <a href="http://nshipster.com/nsurlcache/" target="_blank" rel="external"><code>NSURLCache</code></a> <code>sharedCache</code> is enabled by default and will be used by any <a href="https://developer.apple.com/library/mac/documentation/cocoa/reference/foundation/classes/NSURLConnection_Class/Reference/Reference.html" target="_blank" rel="external"><code>NSURLConnection</code></a>objects fetching URL contents for you.</p>
<p>Unfortunately, it has a tendency to hog memory and does not write to disk in its default configuration. To tame the beast and potentially add some persistance, you can simply declare a shared <a href="http://nshipster.com/nsurlcache/" target="_blank" rel="external"><code>NSURLCache</code></a> in your app delegate like so:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NSURLCache *sharedCache = [[NSURLCache alloc] initWithMemoryCapacity:2 * 1024 * 1024</span><br><span class="line">                                              diskCapacity:100 * 1024 * 1024</span><br><span class="line">                                              diskPath:nil];</span><br><span class="line">[NSURLCache setSharedURLCache:sharedCache];</span><br></pre></td></tr></table></figure>
<p><a href="http://blog.originate.com/blog/2014/02/20/afimagecache-vs-nsurlcache/" target="_blank" rel="external">How Does Caching Work in AFNetworking? : AFImageCache &amp; NSUrlCache Explained</a></p>
<p><a href="http://www.hpique.com/2014/03/how-to-cache-server-responses-in-ios-apps/" target="_blank" rel="external">How to cache server responses in iOS apps</a></p>
<p><a href="https://cnbin.github.io/blog/2016/02/20/http-qing-qiu-,-xiang-ying-,-huan-cun/" target="_blank" rel="external">HTTP-è¯·æ±‚ã€å“åº”ã€ç¼“å­˜</a></p>
<p><a href="http://tools.jb51.net/table/http_request_method" target="_blank" rel="external">HTTPè¯·æ±‚æ–¹æ³•å¯¹ç…§è¡¨</a><br><a href="http://www.cocoachina.com/ios/20160525/16438.html" target="_blank" rel="external">HTTP in iOSä½ çœ‹æˆ‘å°±å¤Ÿ</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="atony2099.github.io/2016/01/07/copy/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="tony2009">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="æ‰˜å°¼çš„å¼€å‘ç¬”è®°">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="æ‰˜å°¼çš„å¼€å‘ç¬”è®°" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/07/copy/" itemprop="url">
                  copyæ¢ç©¶
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-01-07T00:24:48+08:00">
                2016-01
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="1-æµ…æ‹·è´-amp-amp-æ·±æ‹·è´"><a href="#1-æµ…æ‹·è´-amp-amp-æ·±æ‹·è´" class="headerlink" title="1. æµ…æ‹·è´&amp;&amp;æ·±æ‹·è´"></a>1. æµ…æ‹·è´&amp;&amp;æ·±æ‹·è´</h4><p><img src="http://upload-images.jianshu.io/upload_images/1111290-d90c09e5df129a5a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1111290-bc1700453091b35d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2"></p>
<p>å¦‚å›¾æ‰€ç¤º,æµ…æ‹·è´åªæ˜¯å¯¹æŒ‡é’ˆçš„å¤åˆ¶ï¼Œè€Œæ·±æ‹·è´ä¸ä»…å¤åˆ¶äº†æŒ‡é’ˆï¼Œè€Œä¸”å¤åˆ¶äº†æŒ‡é’ˆæ‰€æŒ‡å‘çš„å¯¹è±¡</p>
<h4 id="2-éé›†åˆå¯¹è±¡å’Œé›†åˆå¯¹è±¡çš„å¤åˆ¶"><a href="#2-éé›†åˆå¯¹è±¡å’Œé›†åˆå¯¹è±¡çš„å¤åˆ¶" class="headerlink" title="2.éé›†åˆå¯¹è±¡å’Œé›†åˆå¯¹è±¡çš„å¤åˆ¶"></a>2.éé›†åˆå¯¹è±¡å’Œé›†åˆå¯¹è±¡çš„å¤åˆ¶</h4><p>â€‹    ä¾‹1ï¼šå¯¹NSStringè¿›è¡Œ<code>copy</code> å’Œ<code>mutableCopy</code>æ“ä½œ</p>
<p><img src="http://i4.piimg.com/567571/6ba311780cc68886.png" alt=""></p>
<p><img src="http://i2.piimg.com/567571/5ef7ea3ff110a20d.png" alt=""></p>
<p>â€‹    ä¾‹2ï¼šå¯¹NSMutableStringè¿›è¡Œ<code>copy</code> å’Œ<code>mutableCopy</code>æ“ä½œ</p>
<p><img src="http://i2.piimg.com/567571/8a51f2e1269869c1.png" alt=""></p>
<p><img src="http://i2.piimg.com/567571/272b2ee7212b4f41.png" alt=""></p>
<p><strong>ç»¼åˆä»¥ä¸Šä¸¤ä¸ªä¾‹å­,æˆ‘ä»¬å¯ä»¥å¾—å‡ºå¦‚ä¸‹ç»“è®º</strong></p>
<blockquote>
<ul>
<li>[immutableObject copy] // æµ…å¤åˆ¶</li>
<li>[immutableObject mutableCopy] //æ·±å¤åˆ¶</li>
<li>[mutableObject copy] //æ·±å¤åˆ¶</li>
<li>[mutableObject mutableCopy] //æ·±å¤åˆ¶</li>
</ul>
<p>warnings: å¯¹é›†åˆå¯¹è±¡(NSArray,NSDictonaryâ€¦)ä¸Šé¢çš„ç»“è®ºä¹ŸåŒæ ·ä½¿ç”¨ï¼Œä½†æ˜¯å¯¹äºé›†åˆå¯¹è±¡é‡Œé¢çš„å…ƒç´ å¯¹è±¡ï¼Œå§‹ç»ˆæ˜¯æµ…å¤åˆ¶ï¼Œä¹Ÿå³åªæ˜¯å¤åˆ¶æŒ‡é’ˆã€‚</p>
</blockquote>
<h4 id="Copyå…³é”®å­—çš„ä½¿ç”¨"><a href="#Copyå…³é”®å­—çš„ä½¿ç”¨" class="headerlink" title="Copyå…³é”®å­—çš„ä½¿ç”¨"></a>Copyå…³é”®å­—çš„ä½¿ç”¨</h4><p>é€šå¸¸æˆ‘ä»¬å£°æ˜NSStringï¼ŒNSArrayï¼ŒNSDictonaryç±»å‹çš„å˜é‡çš„æ—¶å€™ï¼Œéƒ½æ˜¯ä½¿ç”¨copyå…³é”®å­—ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>stackoverflowæœ‰ä¸ªç±»ä¼¼çš„é—®é¢˜<a href="http://stackoverflow.com/questions/387959/nsstring-property-copy-or-retain" target="_blank" rel="external">NSString property: copy or retain?</a></p>
<blockquote>
<p> For attributes whose type is an immutable value class that conforms to the <code>NSCopying</code> protocol, you almost always should specify <code>copy</code> in your <code>@property</code> declaration. Specifying <code>retain</code>(strong) is something you almost never want in such a situation.</p>
</blockquote>
<p>ä»æ ¹æœ¬ä¸Šè¯´ï¼Œç”±äºobject-cæ˜¯ä¸€é—¨å¤šæ€çš„è¯­è¨€ï¼Œæˆ‘ä»¬å£°æ˜å˜é‡ä¸ºNSStringï¼ŒNSArrayï¼ŒNSDictonaryç±»å‹çš„æ—¶å€™ï¼Œæœ¬æ„æ˜¯æƒ³å˜é‡ä¸ºä¸å¯å˜ç±»å‹ï¼Œä½†ç”±äºçˆ¶ç±»çš„æŒ‡é’ˆå¯ä»¥æŒ‡å‘å­ç±»å¯¹è±¡ï¼Œæ‰€æœ‰å°±æœ‰å¯èƒ½å‘ç”ŸæœªçŸ¥çš„é”™è¯¯ï¼Œå¦‚ä¸‹: </p>
<p><img src="http://i2.piimg.com/567571/348394d76131ec1c.png" alt=""></p>
<p>ä¸Šé¢è¾“å‡ºçš„ç»“æœæ˜¯<code>hi world</code>,è€Œä¸æ˜¯æˆ‘ä»¬ä¸€å¼€å§‹æŒ‡å®šçš„<code>hello wrold</code>ï¼Œè€Œå¦‚æœæˆ‘ä»¬æŒ‡å®šå…³é”®å­—ä¸º<code>copy</code>, å°±èƒ½ä¿è¯nameæŒ‡é’ˆæŒ‡å‘çš„æ˜¯immutableObjectï¼Œé˜²æ­¢æ•°æ®è¢«ç¯¡æ”¹è€Œä¸€èµ·ä¸å¿…è¦çš„éº»çƒ¦ã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="atony2099.github.io/2015/12/12/å†…å­˜ç®¡ç†/autoreleasepool/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="tony2009">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="æ‰˜å°¼çš„å¼€å‘ç¬”è®°">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="æ‰˜å°¼çš„å¼€å‘ç¬”è®°" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/12/å†…å­˜ç®¡ç†/autoreleasepool/" itemprop="url">
                  autorelesePool
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-12-12T20:18:02+08:00">
                2015-12
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="autoreleasePoolçš„å®ç°åŸç†"><a href="#autoreleasePoolçš„å®ç°åŸç†" class="headerlink" title="autoreleasePoolçš„å®ç°åŸç†"></a>autoreleasePoolçš„å®ç°åŸç†</h4><ol>
<li>autoreleasePoolæ˜¯ç”±è‹¥å¹²ä¸ªAutoreleasePoolPageä»¥åŒå‘é“¾è¡¨ç»„æˆï¼Œ æ¯ä¸€ä¸ªçº¿ç¨‹çš„ autoreleasepool æŒ‰å †æ ˆçš„æ–¹å¼å­˜å‚¨å¯¹è±¡çš„æŒ‡é’ˆï¼Œid *nextæŒ‡é’ˆä½œä¸ºæ¸¸æ ‡æŒ‡å‘æ ˆé¡¶æœ€æ–°addè¿›æ¥çš„autoreleaseå¯¹è±¡çš„ä¸‹ä¸€ä¸ªä½ç½®<ul>
<li>ä¸€ä¸ªAutoreleasePoolPageçš„ç©ºé—´è¢«å æ»¡æ—¶ï¼Œä¼šæ–°å»ºä¸€ä¸ªAutoreleasePoolPageå¯¹è±¡ï¼Œè¿æ¥é“¾è¡¨ï¼Œåæ¥çš„autoreleaseå¯¹è±¡åœ¨æ–°çš„pageåŠ å…¥</li>
<li>æ¯å½“è¿›è¡Œä¸€æ¬¡objc_autoreleasePoolPushè°ƒç”¨æ—¶ï¼Œruntimeå‘å½“å‰çš„AutoreleasePoolPageä¸­addè¿›ä¸€ä¸ª`å“¨å…µå¯¹è±¡ï¼Œå€¼ä¸º0ï¼ˆä¹Ÿå°±æ˜¯ä¸ªnilï¼‰,å¹¶ä»å“¨å…µå¯¹è±¡å¯¹è±¡å¯¹è±¡ä½ç½®å¼€å§‹å­˜å‚¨æŒ‡é’ˆ</li>
</ul>
</li>
</ol>
<p><img src="http://ohbzayk4i.bkt.clouddn.com/17-1-17/66532911-file_1484604072733_11269.jpg" alt=""></p>
<ol>
<li>objc_autoreleasePoolPushçš„è¿”å›å€¼æ­£æ˜¯è¿™ä¸ªå“¨å…µå¯¹è±¡çš„åœ°å€ï¼Œè¢«objc_autoreleasePoolPop(å“¨å…µå¯¹è±¡)ä½œä¸ºå…¥å‚ï¼Œäºæ˜¯ï¼š<ul>
<li>æ ¹æ®ä¼ å…¥çš„å“¨å…µå¯¹è±¡åœ°å€æ‰¾åˆ°å“¨å…µå¯¹è±¡æ‰€å¤„çš„page</li>
<li>åœ¨å½“å‰pageä¸­ï¼Œå°†æ™šäºå“¨å…µå¯¹è±¡æ’å…¥çš„æ‰€æœ‰autoreleaseå¯¹è±¡éƒ½å‘é€ä¸€æ¬¡- releaseæ¶ˆæ¯ï¼Œå¹¶å‘å›ç§»åŠ¨nextæŒ‡é’ˆåˆ°æ­£ç¡®ä½ç½®<br><img src="http://ohbzayk4i.bkt.clouddn.com/17-1-17/52002764-file_1484604072858_134b7.jpg" alt=""></li>
</ul>
</li>
</ol>
<h4 id="autoreleased-å¯¹è±¡çš„é‡Šæ”¾æ—¶æœº"><a href="#autoreleased-å¯¹è±¡çš„é‡Šæ”¾æ—¶æœº" class="headerlink" title="autoreleased å¯¹è±¡çš„é‡Šæ”¾æ—¶æœº"></a>autoreleased å¯¹è±¡çš„é‡Šæ”¾æ—¶æœº</h4><p><img src="http://ohbzayk4i.bkt.clouddn.com/17-1-17/32208599-file_1484656781760_283c.gif" alt=""></p>
<p> åœ¨æ¯ä¸€ä¸ªrunloopå‘¨æœŸå†…ï¼Œrunloop éƒ½ä¼šåˆ›å»ºä¸€ä¸ªautoreleasepoolï¼Œåœ¨runloopå³å°†ä¼‘çœ  drain è¿™ä¸ªpool</p>
<p>autoreleasedå¯¹è±¡æ­¤æ—¶è¢«é‡Šæ”¾</p>
<h4 id="autoreleasepool-ä½¿ç”¨åœºæ™¯"><a href="#autoreleasepool-ä½¿ç”¨åœºæ™¯" class="headerlink" title="autoreleasepool ä½¿ç”¨åœºæ™¯"></a>autoreleasepool ä½¿ç”¨åœºæ™¯</h4><ol>
<li><p>If you write a loop that creates many temporary objects.</p>
<p>You may use an autorelease pool block inside the loop to dispose of those objects before the next iteration. Using an autorelease pool block in the loop helps to reduce the maximum memory footprint of the application</p>
<blockquote>
<p>ä¸ªäººç†è§£: å¦‚æœåœ¨çŸ­æ—¶é—´åˆ›å»ºäº†å¤§é‡autoreleasedå¯¹è±¡ï¼Œå†…å­˜ä¼šè¿…é€Ÿå¢åŠ ï¼Œä½†æ˜¯autoreleasedå¯¹è±¡è¦ç­‰å¾…æœ¬æ¬¡runloopå‘¨æœŸç»“æŸåæ‰é‡Šæ”¾ï¼Œè¿™æ—¶å€™å¯ä»¥æ‰‹åŠ¨åˆ›å»ºautoreleasepoolæ± å³æ—¶é‡Šæ”¾</p>
</blockquote>
<p>â€‹</p>
</li>
<li><p>If you spawn a secondary thread.</p>
<p>You must create your own autorelease pool block as soon as the thread begins executing; otherwise, your application will leak objects.</p>
<blockquote>
<p>ä¸ªäººç†è§£: åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æœ€é•¿ä½¿ç”¨æ—¶GCDå’ŒNSOperation,åœ¨ä¸¤ä¸ªæ¡†æ¶ä¸‹ï¼Œä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æ„å»ºautoreleasepoolï¼Œæ‰€ä»¥å³ä½¿æ²¡æœ‰æ˜¾ç¤ºè°ƒç”¨autoreleasepoolï¼Œä¹Ÿä¸ä¸€å®šä¼šé€ æˆå¾ˆå¤§çš„å†…å­˜æ³„éœ²é—®é¢˜,</p>
<p>ä½†æ˜¯åˆ›å»ºå¤§é‡å¯¹è±¡çš„æ—¶å€™è¿˜æ˜¯æ•…æ„è‡ªå·±ä¸»åŠ¨åˆ›å»ºautoreleasepool</p>
</blockquote>
<p>å‚è€ƒstack overflowï¼š</p>
<p><a href="http://stackoverflow.com/questions/4141123/do-you-need-to-create-an-nsautoreleasepool-within-a-block-in-gcd" target="_blank" rel="external">Do you need to create an NSAutoreleasePool within a block in GCD?</a></p>
<blockquote>
<p>If your block creates more than a few Objective-C objects, you might want to enclose parts of your blockâ€™s code in an @autorelease block to handle the memory management for those objects. Although GCD dispatch queues have their own autorelease pools, they make no guarantees as to when those pools are drained. If your application is memory constrained, creating your own autorelease pool allows you to free up the memory for autoreleased objects at more regular intervals.</p>
</blockquote>
<p>â€‹</p>
</li>
</ol>
<p><a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/MemoryMgmt/Articles/mmAutoreleasePools.html" target="_blank" rel="external">Using Autorelease Pool Blocks</a></p>
<p><a href="http://blog.sunnyxx.com/2014/10/15/behind-autorelease/" target="_blank" rel="external">é»‘å¹•èƒŒåçš„Autorelease</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="atony2099.github.io/2015/12/12/load&&initialize/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="tony2009">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="æ‰˜å°¼çš„å¼€å‘ç¬”è®°">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="æ‰˜å°¼çš„å¼€å‘ç¬”è®°" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/12/load&&initialize/" itemprop="url">
                  load && initialize
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-12-12T16:32:39+08:00">
                2015-12
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="load-amp-amp-initialize"><a href="#load-amp-amp-initialize" class="headerlink" title="load &amp;&amp; initialize"></a>load &amp;&amp; initialize</h4><ul>
<li>load</li>
</ul>
<blockquote>
<p>Invoked whenever a class or category is added to the Objective-C runtime; implement this method to perform class-specific behavior upon loading.</p>
<p>The load message is sent to classes and categories that are both dynamically loaded and statically linked, but only if the newly loaded class or category implements a method that can respond.</p>
</blockquote>
<p>ä»ä¸Šé¢çš„æè¿°å¯ä»¥çœ‹å‡ºè¿™ä¸ªæ–¹æ³•è°ƒç”¨çš„æ—¶æœºå¾ˆæ—©ï¼Œåœ¨ç±»(åˆ†ç±»)è¢«åŠ è½½åˆ°runtimeçš„æ—¶å€™å°±ä¼šè°ƒç”¨ï¼ŒåŒæ—¶åªæœ‰ç±»å®ç°äº†è¿™ä¸ªæ–¹æ³•æ‰èƒ½è¢«å“åº”ã€‚</p>
<ul>
<li>initialize</li>
</ul>
<blockquote>
<p>The runtime sends initialize to each class in a program just before the class, or any class that inherits from it, is sent its first message from within the program. </p>
</blockquote>
<p>ä¸åŒäºloadï¼Œinitializeåªæœ‰åœ¨ç±»æˆ–è€…å®ƒçš„å­ç±»ç¬¬ä¸€æ¬¡æ¥æ”¶åˆ°æ¶ˆæ¯ä¹‹å‰æ‰ä¼šè°ƒç”¨,ç›¸å½“äºæ‡’åŠ è½½ã€‚</p>
<h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">int main(int argc, char * argv[]) &#123;</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">        NSLog(@&quot;%s&quot;,__func__);</span><br><span class="line">        return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@interface Animal : NSObject</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation Animal</span><br><span class="line">+ (void)load&#123;</span><br><span class="line">    NSLog(@&quot;%s&quot;,__func__);</span><br><span class="line">&#125;</span><br><span class="line">+ (void)initialize&#123;</span><br><span class="line">    [super initialize];</span><br><span class="line">    NSLog(@&quot;%s %@&quot;,__func__,[self class]);</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@interface Dog : Animal</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation Dog</span><br><span class="line">+ (void)load&#123;</span><br><span class="line">    NSLog(@&quot;%s &quot;,__func__);</span><br><span class="line">&#125;</span><br><span class="line">+ (void)initialize&#123;</span><br><span class="line">    [super initialize];</span><br><span class="line">    NSLog(@&quot;%s &quot;,__func__);</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>åœ¨main.mæ–‡ä»¶é‡Œæ‰§è¡Œä¸Šè¿°ä»£ç ï¼Œå¯ä»¥è¾“å‡º</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+[Animal load]</span><br><span class="line">+[Dog load] </span><br><span class="line">main</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºåœ¨æ²¡æœ‰ä¸»åŠ¨å¯¹ç±»æ‰§è¡Œæ“ä½œæƒ…å†µä¸‹ï¼Œloadä¼šé»˜è®¤æ‰§è¡Œï¼Œå¹¶ä¸”åœ¨mainå‡½æ•°ä¹‹å‰æ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">@interface Animal : NSObject</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation Animal</span><br><span class="line">+ (void)load&#123;</span><br><span class="line">    NSLog(@&quot;%s &quot;,__func__);</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">+ (void)initialize &#123;</span><br><span class="line">    NSLog(@&quot;%s %@&quot;,__func__,[self class]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface Dog : Animal</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation Dog</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation ViewController</span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    Dog *dog = [[Dog alloc] init];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»“æœ: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+[Animal load]</span><br><span class="line">+[Animal initialize] Animal</span><br><span class="line">+[Animal initialize] Dog</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹å‡ºinitializeæ˜æ˜¾çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯å½“å­ç±»æ²¡æœ‰å®ç°çš„æ—¶å€™ï¼Œå®ƒä¼šä¸»åŠ¨è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œè€Œloadå¹¶æ²¡æœ‰è¿™ä¸€ç‰¹æ€§ï¼Œä¸ºäº†è§£é‡Šè¿™ä¸€ç‰¹æ€§ï¼Œæˆ‘ä»¬å¾—ä»runtimeæºç å±‚é¢å‰–æ: </p>
<p>loadæ–¹æ³•çš„è°ƒç”¨æ ¸å¿ƒä»£ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// Call all +loads for the detached list.</span><br><span class="line">for (i = 0; i &lt; used; i++) &#123;</span><br><span class="line">    Class cls = classes[i].cls;</span><br><span class="line">    load_method_t load_method = (load_method_t)classes[i].method;</span><br><span class="line">    if (!cls) continue;</span><br><span class="line"></span><br><span class="line">    if (PrintLoading) &#123;</span><br><span class="line">        _objc_inform(&quot;LOAD: +[%s load]\n&quot;, cls-&gt;nameForLogging());</span><br><span class="line">    &#125;</span><br><span class="line">    (*load_method)(cls, SEL_load);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç å¾ªç¯è°ƒç”¨æ‰€æœ‰ç±»çš„ +load æ–¹æ³•ã€‚<strong>æ³¨æ„</strong>ï¼Œè¿™é‡Œæ˜¯ï¼ˆè°ƒç”¨åˆ†ç±»çš„ +load æ–¹æ³•ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰ç›´æ¥ä½¿ç”¨å‡½æ•°å†…å­˜åœ°å€çš„æ–¹å¼ <code>(*load_method)(cls, SEL_load);</code> å¯¹ +load æ–¹æ³•è¿›è¡Œè°ƒç”¨çš„ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å‘é€æ¶ˆæ¯ <code>objc_msgSend</code> çš„æ–¹å¼ã€‚</p>
<p>è¿™æ ·çš„è°ƒç”¨æ–¹å¼å°±ä½¿å¾— +load æ–¹æ³•æ‹¥æœ‰äº†ä¸€ä¸ªéå¸¸æœ‰è¶£çš„ç‰¹æ€§ï¼Œé‚£å°±æ˜¯å­ç±»ã€çˆ¶ç±»å’Œåˆ†ç±»ä¸­çš„ +load æ–¹æ³•çš„å®ç°æ˜¯è¢«åŒºåˆ«å¯¹å¾…çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœå­ç±»æ²¡æœ‰å®ç° +load æ–¹æ³•ï¼Œé‚£ä¹ˆå½“å®ƒè¢«åŠ è½½æ—¶ runtime æ˜¯ä¸ä¼šå»è°ƒç”¨çˆ¶ç±»çš„ +load æ–¹æ³•çš„ã€‚åŒç†ï¼Œå½“ä¸€ä¸ªç±»å’Œå®ƒçš„åˆ†ç±»éƒ½å®ç°äº† +load æ–¹æ³•æ—¶ï¼Œä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šè¢«è°ƒç”¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">void _class_initialize(Class cls)</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    Class supercls;</span><br><span class="line">    BOOL reallyInitialize = NO;</span><br><span class="line"></span><br><span class="line">    // Make sure super is done initializing BEFORE beginning to initialize cls.</span><br><span class="line">    // See note about deadlock above.</span><br><span class="line">    supercls = cls-&gt;superclass;</span><br><span class="line">    if (supercls  &amp;&amp;  !supercls-&gt;isInitialized()) &#123;</span><br><span class="line">        _class_initialize(supercls);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Try to atomically set CLS_INITIALIZING.</span><br><span class="line">    monitor_enter(&amp;classInitLock);</span><br><span class="line">    if (!cls-&gt;isInitialized() &amp;&amp; !cls-&gt;isInitializing()) &#123;</span><br><span class="line">        cls-&gt;setInitializing();</span><br><span class="line">        reallyInitialize = YES;</span><br><span class="line">    &#125;</span><br><span class="line">    monitor_exit(&amp;classInitLock);</span><br><span class="line"></span><br><span class="line">    if (reallyInitialize) &#123;</span><br><span class="line">        // We successfully set the CLS_INITIALIZING bit. Initialize the class.</span><br><span class="line"></span><br><span class="line">        // Record that we&apos;re initializing this class so we can message it.</span><br><span class="line">        _setThisThreadIsInitializingClass(cls);</span><br><span class="line"></span><br><span class="line">        // Send the +initialize message.</span><br><span class="line">        // Note that +initialize is sent to the superclass (again) if </span><br><span class="line">        // this class doesn&apos;t implement +initialize. 2157218</span><br><span class="line">        if (PrintInitializing) &#123;</span><br><span class="line">            _objc_inform(&quot;INITIALIZE: calling +[%s initialize]&quot;,</span><br><span class="line">                         cls-&gt;nameForLogging());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ((void(*)(Class, SEL))objc_msgSend)(cls, SEL_initialize);</span><br><span class="line"></span><br><span class="line">        if (PrintInitializing) &#123;</span><br><span class="line">            _objc_inform(&quot;INITIALIZE: finished +[%s initialize]&quot;,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç æœ‰ä¸¤ä¸ªå…³é”®ç‚¹: </p>
<ul>
<li>å…¥å‚çš„çˆ¶ç±»è¿›è¡Œäº†é€’å½’è°ƒç”¨ï¼Œä»¥ç¡®ä¿çˆ¶ç±»ä¼˜å…ˆäºå­ç±»åˆå§‹åŒ–</li>
<li>runtime ä½¿ç”¨äº†å‘é€æ¶ˆæ¯ <code>objc_msgSend</code>çš„æ–¹å¼å¯¹ +initialize æ–¹æ³•è¿›è¡Œè°ƒç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ +initialize æ–¹æ³•çš„è°ƒç”¨ä¸æ™®é€šæ–¹æ³•çš„è°ƒç”¨æ˜¯ä¸€æ ·çš„ï¼Œèµ°çš„éƒ½æ˜¯å‘é€æ¶ˆæ¯çš„æµç¨‹ã€‚æ¢è¨€ä¹‹ï¼Œå¦‚æœå­ç±»æ²¡æœ‰å®ç° +initialize æ–¹æ³•ï¼Œé‚£ä¹ˆç»§æ‰¿è‡ªçˆ¶ç±»çš„å®ç°ä¼šè¢«è°ƒç”¨ï¼›å¦‚æœä¸€ä¸ªç±»çš„åˆ†ç±»å®ç°äº† +initialize æ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹è¿™ä¸ªç±»ä¸­çš„å®ç°é€ æˆè¦†ç›–</li>
</ul>
<h4 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h4><ul>
<li><p>load</p>
<blockquote>
<p>method swizzling</p>
</blockquote>
</li>
</ul>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ul>
<li>ä¸¤è€…åœ¨runtimeéƒ½æ˜¯é€’å½’è°ƒç”¨ï¼Œçˆ¶ç±»å…ˆäºå­ç±»è¢«è°ƒç”¨</li>
<li>loadæ ¹æ®å‡½æ•°åœ°å€å‘é€ï¼Œ(åˆ†ç±».å­ç±»ï¼Œçˆ¶ç±»è°ƒç”¨åˆ†å¼€)  initialise(æ‡’åŠ è½½) meg_sendå‘é€ (å­ç±»æ²¡æœ‰å®ç°ä¼šæŸ¥æ‰¾çˆ¶äº²çš„æ–¹æ³•åˆ—è¡¨ï¼Œåˆ†ç±»è¦†ç›–æ‰€å±ç±»çš„å®ç°)</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>+load</th>
<th>+initialize</th>
</tr>
</thead>
<tbody>
<tr>
<td>è°ƒç”¨æ—¶æœº</td>
<td>è¢«æ·»åŠ åˆ° runtime æ—¶</td>
<td>æ”¶åˆ°ç¬¬ä¸€æ¡æ¶ˆæ¯å‰ï¼Œå¯èƒ½æ°¸è¿œä¸è°ƒç”¨</td>
</tr>
<tr>
<td>è°ƒç”¨é¡ºåº</td>
<td>çˆ¶ç±»-&gt;å­ç±»-&gt;åˆ†ç±»</td>
<td>çˆ¶ç±»-&gt;å­ç±»</td>
</tr>
<tr>
<td>è°ƒç”¨æ¬¡æ•°</td>
<td>1æ¬¡</td>
<td>å¤šæ¬¡</td>
</tr>
<tr>
<td>è‹¥è‡ªèº«æœªå®šä¹‰ï¼Œæ˜¯å¦æ²¿ç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Ÿ</td>
<td>å¦</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>åˆ†ç±»ä¸­çš„å®ç°</td>
<td>ç±»å’Œåˆ†ç±»éƒ½æ‰§è¡Œ</td>
<td>è¦†ç›–ç±»ä¸­çš„æ–¹æ³•ï¼Œåªæ‰§è¡Œåˆ†ç±»çš„å®ç°</td>
</tr>
</tbody>
</table>
<p>å‚è€ƒ: </p>
<p><a href="http://blog.leichunfeng.com/blog/2015/05/02/objective-c-plus-load-vs-plus-initialize/" target="_blank" rel="external">Objective-C +load vs +initialize</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="atony2099.github.io/2015/12/11/å†…å­˜ç®¡ç†/å†…å­˜ç®¡ç†/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="tony2009">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="æ‰˜å°¼çš„å¼€å‘ç¬”è®°">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="æ‰˜å°¼çš„å¼€å‘ç¬”è®°" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/11/å†…å­˜ç®¡ç†/å†…å­˜ç®¡ç†/" itemprop="url">
                  å†…å­˜ç®¡ç†
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-12-11T23:38:06+08:00">
                2015-12
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>version 1.0  <object-cé«˜çº§æ ‡ç¼–ç¨‹> 19é¡µ 68é¡µ å…³äºhashMap è¿˜ä¸æ˜¯å¾ˆæ‡‚</object-cé«˜çº§æ ‡ç¼–ç¨‹></p>
</blockquote>
<h4 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h4><p>å‚è€ƒ: <a href="http://www.cnblogs.com/jsean/articles/1599799.html" target="_blank" rel="external">HEAPå’ŒSTACKçš„åŒºåˆ«</a></p>
<p><a href="http://c.biancheng.net/cpp/biancheng/view/141.html" target="_blank" rel="external">C++å˜é‡çš„å­˜å‚¨ç±»åˆ«ï¼ˆåŠ¨æ€å­˜å‚¨ã€é™æ€å­˜å‚¨ã€è‡ªåŠ¨å˜é‡ã€å¯„å­˜å™¨å˜é‡ã€å¤–éƒ¨å˜é‡ï¼‰</a></p>
<p><strong>è‡ªåŠ¨å˜é‡</strong>ï¼ˆ<em>Automatic Variable</em>ï¼‰æŒ‡çš„æ˜¯å±€éƒ¨<a href="https://zh.wikipedia.org/wiki/%E4%BD%9C%E7%94%A8%E5%9F%9F" target="_blank" rel="external">ä½œç”¨åŸŸ</a><a href="https://zh.wikipedia.org/wiki/%E5%8F%98%E9%87%8F_(%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1" target="_blank" rel="external">å˜é‡</a>)ï¼Œ å…·ä½“æ¥è¯´å³æ˜¯åœ¨<a href="https://zh.wikipedia.org/wiki/%E6%8E%A7%E5%88%B6%E6%B5%81" target="_blank" rel="external">æ§åˆ¶æµ</a>è¿›å…¥å˜é‡ä½œç”¨åŸŸæ—¶ç³»ç»Ÿè‡ªåŠ¨ä¸ºå…¶<a href="https://zh.wikipedia.org/wiki/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86" target="_blank" rel="external">åˆ†é…å­˜å‚¨ç©ºé—´</a>ï¼Œå¹¶åœ¨ç¦»å¼€ä½œç”¨åŸŸæ—¶é‡Šæ”¾ç©ºé—´çš„ä¸€ç±»å˜é‡ã€‚åœ¨è®¸å¤š<a href="https://zh.wikipedia.org/wiki/%E7%A8%8B%E5%BA%8F%E8%AA%9E%E8%A8%80" target="_blank" rel="external">ç¨‹åºè¯­è¨€</a>ä¸­ï¼Œè‡ªåŠ¨å˜é‡ä¸æœ¯è¯­â€œ<a href="https://zh.wikipedia.org/wiki/%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F" target="_blank" rel="external">å±€éƒ¨å˜é‡</a>â€ï¼ˆ<em>Local Variable</em>ï¼‰æ‰€æŒ‡çš„å˜é‡å®é™…ä¸Šæ˜¯åŒä¸€ç§å˜é‡ã€‚</p>
<h5 id="å†…å­˜å¸ƒå±€"><a href="#å†…å­˜å¸ƒå±€" class="headerlink" title="å†…å­˜å¸ƒå±€"></a>å†…å­˜å¸ƒå±€</h5><p>æ ˆåŒºï¼š ç³»ç»Ÿè‡ªåŠ¨åˆ†é…å¹¶é‡Šæ”¾çš„ï¼Œ å­˜æ”¾å±€éƒ¨å˜é‡å’Œå½¢å‚ ï¼Œç”¨æ ˆçš„æ–¹å¼æ“ä½œ(fifo)ï¼Œè¿ç»­</p>
<p>å †åŒºï¼šç”±ç¨‹åºå‘˜æ‰‹åŠ¨åˆ›å»ºå¹¶é‡Šæ”¾ï¼Œå­˜æ”¾å¯¹è±¡ ï¼Œ ç”¨é“¾è¡¨æ–¹å¼è®°å½•ç©ºé—²åœ°å€ï¼Œä¸è¿ç»­</p>
<p>å…¨å±€åŒº(é™æ€åŒº)ï¼šå…¨å±€å˜é‡å’Œé™æ€å˜é‡</p>
<p>å¸¸é‡åŒº: å­˜æ”¾å¸¸é‡å­—ç¬¦ä¸²ï¼Œç¨‹åºç»“æŸåç”±ç³»ç»Ÿé‡Šæ”¾</p>
<p>ä»£ç åŒºï¼šå­˜æ”¾äºŒè¿›åˆ¶ä»£ç </p>
<p><img src="http://upload-images.jianshu.io/upload_images/1232160-0db68b7366e194e3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&amp;_=5707006" alt=""></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">main.cpp </span><br><span class="line">ã€€ã€€<span class="keyword">int</span> a = <span class="number">0</span>; å…¨å±€åˆå§‹åŒ–åŒº </span><br><span class="line">ã€€ã€€<span class="keyword">char</span> *p1; å…¨å±€æœªåˆå§‹åŒ–åŒº </span><br><span class="line">ã€€ã€€main() </span><br><span class="line">ã€€ã€€&#123; </span><br><span class="line">ã€€ã€€<span class="keyword">int</span> b; æ ˆ </span><br><span class="line">ã€€ã€€<span class="keyword">char</span> s[] = <span class="string">"abc"</span>; æ ˆ </span><br><span class="line">ã€€ã€€<span class="keyword">char</span> *p2; æ ˆ </span><br><span class="line">ã€€ã€€<span class="keyword">char</span> *p3 = <span class="string">"123456"</span>; <span class="number">123456</span>\<span class="number">0</span>åœ¨å¸¸é‡åŒºï¼Œp3åœ¨æ ˆä¸Šã€‚ </span><br><span class="line">ã€€ã€€<span class="keyword">static</span> <span class="keyword">int</span> c =<span class="number">0</span>ï¼› å…¨å±€ï¼ˆé™æ€ï¼‰åˆå§‹åŒ–åŒº </span><br><span class="line">ã€€ã€€p1 = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">10</span>);  å †</span><br><span class="line">ã€€ã€€p2 = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">20</span>);  å †</span><br><span class="line">ã€€ã€€&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>æ ˆçš„å­˜å‚¨</strong>ï¼š</p>
<p>åœ¨å‡½æ•°è°ƒç”¨æ—¶ï¼Œç¬¬ä¸€ä¸ªè¿›æ ˆçš„æ˜¯ä¸»å‡½æ•°ä¸­å‡½æ•°è°ƒç”¨åçš„ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼ˆå‡½æ•°è°ƒç”¨è¯­å¥çš„ä¸‹ä¸€æ¡å¯æ‰§è¡Œè¯­å¥ï¼‰çš„åœ°å€ï¼Œç„¶åæ˜¯å‡½æ•°çš„å„ä¸ªå‚æ•°ï¼Œåœ¨å¤§å¤šæ•°çš„Cç¼–è¯‘å™¨ä¸­ï¼Œå‚æ•°æ˜¯ç”±å³å¾€å·¦å…¥æ ˆçš„ï¼Œç„¶åæ˜¯å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡ã€‚æ³¨æ„é™æ€å˜é‡æ˜¯ä¸å…¥æ ˆçš„ã€‚<br>ã€€ã€€å½“æœ¬æ¬¡å‡½æ•°è°ƒç”¨ç»“æŸåï¼Œå±€éƒ¨å˜é‡å…ˆå‡ºæ ˆï¼Œç„¶åæ˜¯å‚æ•°ï¼Œæœ€åæ ˆé¡¶æŒ‡é’ˆæŒ‡å‘æœ€å¼€å§‹å­˜çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯ä¸»å‡½æ•°ä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œç¨‹åºç”±è¯¥ç‚¹ç»§ç»­è¿è¡Œã€‚ </p>
</blockquote>
<h4 id="MRC"><a href="#MRC" class="headerlink" title="MRC:"></a>MRC:</h4><h5 id="æ˜¯ä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h5><p>è‹¹æœä¸ºäº†ç®€åŒ–å†…å­˜ç®¡ç†ï¼Œè®¾è®¡ä¸€å¥—ç®€å•çš„å†…å­˜ç®¡ç†è§„åˆ™ã€‚åœ¨è¿™ä¸ªè§„åˆ™ä¸‹ <strong>å†…å­˜å¯¹è±¡ç”±ç³»ç»Ÿå»å¤„ç†é‡Šæ”¾çš„é—®é¢˜</strong></p>
<p>åˆ›å»ºè€…å’ŒæŒæœ‰è€…å¤„ç†å¥½è‡ªå·±çš„é—®é¢˜</p>
<ul>
<li><p>è°åˆ›å»ºï¼Œè°é‡Šæ”¾ (alloc , new ,copyï¼Œmutable copy ï¼Œ<strong>æˆ–è€…ä»¥è¿™äº›å…³é”®å­—å¼€å¤´çš„è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•</strong>)</p>
<blockquote>
<p><strong>å¦‚æœåˆ›å»ºä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨æ–¹æ³•é‡Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œéä»¥ä¸Šå…³é”®å­—å‘½åçš„ï¼Œé‚£è¿™ä¸ªæ–¹æ³•åº”è¯¥æ€ä¹ˆå†™å‘¢?</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; - (id)object&#123;</span><br><span class="line">&gt;     id obj = [[NSObject alloc]  init];</span><br><span class="line">&gt;     [obj autorelease]; // åœ¨ä¸€ä¸ªrunloopå‘¨æœŸåè¢«é‡Šæ”¾</span><br><span class="line">&gt;</span><br><span class="line">&gt;     return object</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>è°æŒæœ‰ï¼Œè°é‡Šæ”¾(retain)</p>
</li>
</ul>
<h5 id="å®ç°æœºåˆ¶"><a href="#å®ç°æœºåˆ¶" class="headerlink" title="å®ç°æœºåˆ¶"></a>å®ç°æœºåˆ¶</h5><p>å¼•ç”¨è®¡æ•°è¡¨(å“ˆå¸Œè¡¨)</p>
<p>è®°å½•å¯¹è±¡çš„å†…å­˜åœ°å€å’Œå¼•ç”¨æ•°é‡ã€‚å½“å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨æ•°é‡æ˜¯0çš„æ—¶å€™ï¼Œå¯¹è±¡è¢«é”€æ¯</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (retainCount== <span class="number">0</span>) &#123;</span><br><span class="line">  	[self delloc];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ARC"><a href="#ARC" class="headerlink" title="ARC"></a>ARC</h4><p>weakçš„å®ç°</p>
<p>weak å’Œassign éƒ½è¡¨ç¤ºéæ‹¥æœ‰ï¼Œweakä¼šåœ¨ å¯¹è±¡é‡Šæ”¾çš„æ—¶å€™ï¼ŒæŒ‡å‘nilï¼Œå®‰å…¨</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	id __weak obj1 = obj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è½¬æ¢</span></span><br><span class="line">&#123;</span><br><span class="line">  id obj1</span><br><span class="line">  obj1 = <span class="number">0</span>;</span><br><span class="line">  objc_storeweak(&amp;obj1,obj)</span><br><span class="line">  objc_storeweak(&amp;obj1,<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">æ€è·¯ï¼š </span><br><span class="line"><span class="number">1.</span> objc_storeweakä»¥å¯¹è±¡çš„å†…å­˜åœ°å€ä¸ºkeyï¼Œä»¥weakå˜é‡çš„åœ°å€ä¸ºvalueï¼Œæ³¨å†Œåˆ°weakè¡¨ä¸­</span><br><span class="line"><span class="number">2</span>ï¼Œ å¦‚æœç¬¬äºŒä¸ªå‚æ•°ä¸º<span class="number">0</span>(å½“å¯¹è±¡æ²¡æœ‰å¼ºå¼•ç”¨çš„æ—¶å€™)ï¼Œåˆ™åŒæ ·ä»¥å¯¹è±¡çš„å†…å­˜åœ°å€ä¸ºkeyï¼Œé€šè¿‡weakè¡¨æ‰¾åˆ°weakå˜é‡ ï¼Œå°†ä»–ä»¬èµ‹å€¼ä¸ºnilï¼Œä»weakè¡¨ä¸­åˆ é™¤</span><br></pre></td></tr></table></figure>
<p>å¯ç¤ºï¼šweakæ“ä½œä¼šæ¶ˆè€—cpuèµ„æºï¼Œå»ºè®®åªåœ¨å¾ªç¯å¼•ç”¨æ—¶å€™ä½¿ç”¨</p>
<h4 id="autoreleasePool"><a href="#autoreleasePool" class="headerlink" title="autoreleasePool"></a>autoreleasePool</h4><h5 id="autoreleasePoolçš„å®ç°åŸç†"><a href="#autoreleasePoolçš„å®ç°åŸç†" class="headerlink" title="autoreleasePoolçš„å®ç°åŸç†"></a>autoreleasePoolçš„å®ç°åŸç†</h5><p><img src="http://ohbzayk4i.bkt.clouddn.com/17-1-17/11810272-file_1484604058069_224e.jpg" alt=""></p>
<ol>
<li><p>autoreleasePoolæ˜¯ç”±è‹¥å¹²ä¸ªAutoreleasePoolPageä»¥åŒå‘é“¾è¡¨ç»„æˆï¼Œ </p>
<p><strong>æ¯ä¸€ä¸ªçº¿ç¨‹çš„ autoreleasepool æŒ‰å †æ ˆçš„æ–¹å¼å­˜å‚¨å¯¹è±¡çš„æŒ‡é’ˆ</strong></p>
<ul>
<li><code>id *next</code>æŒ‡é’ˆä½œä¸ºæ¸¸æ ‡æŒ‡å‘æ ˆé¡¶æœ€æ–°addè¿›æ¥çš„autoreleaseå¯¹è±¡çš„ä¸‹ä¸€ä¸ªä½ç½®</li>
<li>ä¸€ä¸ªAutoreleasePoolPageçš„ç©ºé—´è¢«å æ»¡æ—¶ï¼Œä¼šæ–°å»ºä¸€ä¸ªAutoreleasePoolPageå¯¹è±¡ï¼Œè¿æ¥é“¾è¡¨ï¼Œåæ¥çš„autoreleaseå¯¹è±¡åœ¨æ–°çš„pageåŠ å…¥</li>
</ul>
</li>
<li><p>æ¯å½“è¿›è¡Œä¸€æ¬¡<code>objc_autoreleasePoolPush</code>è°ƒç”¨æ—¶ï¼Œruntimeå‘å½“å‰çš„AutoreleasePoolPageä¸­<strong>addè¿›ä¸€ä¸ª`å“¨å…µå¯¹è±¡</strong>ï¼Œå€¼ä¸º0ï¼ˆä¹Ÿå°±æ˜¯ä¸ªnilï¼‰</p>
<p><img src="http://ohbzayk4i.bkt.clouddn.com/17-1-17/66532911-file_1484604072733_11269.jpg" alt=""></p>
</li>
<li><p><code>objc_autoreleasePoolPush</code>çš„è¿”å›å€¼æ­£æ˜¯è¿™ä¸ªå“¨å…µå¯¹è±¡çš„åœ°å€ï¼Œè¢«<code>objc_autoreleasePoolPop(å“¨å…µå¯¹è±¡)</code>ä½œä¸ºå…¥å‚ï¼Œäºæ˜¯ï¼š</p>
<ul>
<li>æ ¹æ®ä¼ å…¥çš„å“¨å…µå¯¹è±¡åœ°å€æ‰¾åˆ°å“¨å…µå¯¹è±¡æ‰€å¤„çš„page</li>
<li>åœ¨å½“å‰pageä¸­ï¼Œå°†æ™šäºå“¨å…µå¯¹è±¡æ’å…¥çš„æ‰€æœ‰autoreleaseå¯¹è±¡éƒ½å‘é€ä¸€æ¬¡<code>- release</code>æ¶ˆæ¯ï¼Œå¹¶å‘å›ç§»åŠ¨<code>next</code>æŒ‡é’ˆåˆ°æ­£ç¡®ä½ç½®</li>
</ul>
<p><img src="http://ww3.sinaimg.cn/mw690/51530583gw1elj6u2i3fyj20dz0bqdgi.jpg" alt=""></p>
</li>
</ol>
<h5 id="autoreleasePoolçš„é‡Šæ”¾æ—¶æœº"><a href="#autoreleasePoolçš„é‡Šæ”¾æ—¶æœº" class="headerlink" title="autoreleasePoolçš„é‡Šæ”¾æ—¶æœº"></a>autoreleasePoolçš„é‡Šæ”¾æ—¶æœº</h5><p><img src="http://ohbzayk4i.bkt.clouddn.com/17-1-17/32208599-file_1484656781760_283c.gif" alt=""></p>
<p>åœ¨æ²¡ä¸€ä¸ªrunloopå‘¨æœŸå†…ï¼Œrunloop éƒ½ä¼šåˆ›å»ºä¸€ä¸ªautoreleasepool</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="atony2099.github.io/2015/12/11/æ€§èƒ½ä¼˜åŒ–/æ€§èƒ½ä¼˜åŒ–/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="tony2009">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="æ‰˜å°¼çš„å¼€å‘ç¬”è®°">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="æ‰˜å°¼çš„å¼€å‘ç¬”è®°" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/11/æ€§èƒ½ä¼˜åŒ–/æ€§èƒ½ä¼˜åŒ–/" itemprop="url">
                  æ€§èƒ½ä¼˜åŒ–
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-12-11T13:18:36+08:00">
                2015-12
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="æ˜¾ç¤ºåŸç†"><a href="#æ˜¾ç¤ºåŸç†" class="headerlink" title="æ˜¾ç¤ºåŸç†"></a>æ˜¾ç¤ºåŸç†</h4><p><img src="http://ohbzayk4i.bkt.clouddn.com/17-1-20/95673407-file_1484905412627_29bc.png" alt=""></p>
<ol>
<li>CPU è®¡ç®—å¥½æ˜¾ç¤ºå†…å®¹ï¼Œå¦‚è§†å›¾çš„åˆ›å»ºã€å¸ƒå±€è®¡ç®—ã€å›¾ç‰‡è§£ç ã€æ–‡æœ¬ç»˜åˆ¶ç­‰ã€‚éšåCPUå°†è®¡ç®—å¥½çš„å†…å®¹æäº¤åˆ°GPU</li>
<li>GPUè¿›è¡Œå˜æ¢,åˆæˆï¼Œæ¸²æŸ“ï¼Œ æ¸²æŸ“å®Œæˆåå°†æ¸²æŸ“ç»“æœæ”¾å…¥å¸§ç¼“å†²åŒºï¼Œéšåè§†é¢‘æ§åˆ¶å™¨ä¼šæŒ‰ç…§ VSync ä¿¡å·é€è¡Œè¯»å–å¸§ç¼“å†²åŒºçš„æ•°æ®ï¼Œç»è¿‡å¯èƒ½çš„æ•°æ¨¡è½¬æ¢ä¼ é€’ç»™æ˜¾ç¤ºå™¨æ˜¾ç¤ºã€‚</li>
</ol>
<h4 id="å¡é¡¿äº§ç”Ÿçš„åŸå› "><a href="#å¡é¡¿äº§ç”Ÿçš„åŸå› " class="headerlink" title="å¡é¡¿äº§ç”Ÿçš„åŸå› :"></a>å¡é¡¿äº§ç”Ÿçš„åŸå› :</h4><p><img src="http://ohbzayk4i.bkt.clouddn.com/17-1-21/41214618-file_1484935773331_2c20.jpg" alt=""></p>
<ol>
<li>å½“æ˜¾ç¤ºå™¨çš„ç”µå­æ‰«ææªå›åˆ°åŸä½ï¼Œå‡†å¤‡ä¸‹ä¸€å¸§æ‰«æçš„æ—¶å€™ï¼Œä¼šä»˜å‡ºä¸€ä¸ªVsyncï¼Œ</li>
<li>å½“vsyncå¼€å§‹ä¸‹ä¸€å¸§æ‰«æçš„æ—¶å€™ï¼ŒGPUæ²¡æœ‰æŠŠå®Œæˆæ¸²æŸ“æ”¾åˆ°å¸§ç¼“å†²åŒºï¼Œé‚£ä¸€å¸§å°±ä¼šè¢«åºŸå¼ƒï¼Œè¿™å°±æ˜¯æ‰€è°“çš„æ‰å¸§</li>
</ol>
<blockquote>
<p>æ€»ç»“:æ˜¾ç¤ºå™¨ç§’å›äº§ç”Ÿ60ä¸ªå‚ç›´åŒæ­¥ä¿¡å·ï¼Œå¦‚æœåœ¨ä¿¡å·é—´éš”cpu å’Œ gpu æ²¡æœ‰æŠŠè¦æ˜¾ç¤ºçš„å†…å®¹å‡†å¤‡å¥½ï¼Œé‚£ä¸€å¸§å°±ä¼šè¢«åºŸå¼ƒæ‰ï¼Œäº§ç”Ÿæ‰å¸§ï¼Œè¿™ä¹Ÿæ˜¯å¡é¡¿çš„åŸå› </p>
</blockquote>
<h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><blockquote>
<p>ä¿æŒCPUå’ŒGPUè´Ÿè½½å‡è¡¡</p>
</blockquote>
<h5 id="å‡å°‘CPUçš„è´Ÿè½½"><a href="#å‡å°‘CPUçš„è´Ÿè½½" class="headerlink" title="å‡å°‘CPUçš„è´Ÿè½½:"></a>å‡å°‘CPUçš„è´Ÿè½½:</h5><p><strong>æ–¹æ³•</strong>:ç©ºé—´æ¢æ—¶é—´</p>
<ul>
<li><p>å¯¹è±¡çš„åˆ›å»º: æå‰åˆ›å»ºå¥½ </p>
</li>
<li><p>å¸ƒå±€(æ–‡æœ¬)çš„è®¡ç®—ï¼Œåšç¼“å­˜</p>
</li>
<li><p>å›¾åƒçš„è§£ç : </p>
<blockquote>
<p>Once an image file has been loaded, it must then be decompressed. This decompression can be a computationally complex task and take considerable time. The decompressed image will also use substantially more memory thane the original</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ€è·¯:å¼€å¯å­çº¿ç¨‹è§£ç ï¼Œå‚è€ƒsdwebimageçš„ çš„ decodedImageWithImageæ–¹æ³•</span><br></pre></td></tr></table></figure>
<p>â€‹</p>
</li>
</ul>
<h5 id="å‡å°‘GPUçš„è´Ÿè½½"><a href="#å‡å°‘GPUçš„è´Ÿè½½" class="headerlink" title="å‡å°‘GPUçš„è´Ÿè½½:"></a>å‡å°‘GPUçš„è´Ÿè½½:</h5><ol>
<li><p>å‡å°‘è§†å›¾çš„æ··åˆï¼Œå‡å°‘é€æ˜è§†å›¾çš„æ··åˆ</p>
</li>
<li><p>å‡å°‘ç¦»å±æ¸²æŸ“</p>
<p>â€‹</p>
</li>
</ol>
<p><a href="http://blog.ibireme.com/2015/11/12/smooth_user_interfaces_for_ios/" target="_blank" rel="external">iOS ä¿æŒç•Œé¢æµç•…çš„æŠ€å·§</a></p>
<p><a href="https://gold.xitu.io/post/58667d86128fe10057eae0d2" target="_blank" rel="external">iOS é¡µé¢æ€§èƒ½ä¼˜åŒ–</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="tony2009" />
          <p class="site-author-name" itemprop="name">tony2009</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">83</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">tony2009</span>
</div>


<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  

  




  
  

  

  

  

  


</body>
</html>
